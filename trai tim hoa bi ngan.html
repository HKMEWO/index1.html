<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Burning Heart with Halo</title>
<style>
  body { margin:0; overflow:hidden; background:#000; }
  canvas { display:block; }
</style>
</head>
<body>
<canvas id="heart"></canvas>
<script>
(function(){
  const canvas = document.getElementById('heart');
  const ctx = canvas.getContext('2d');
  let width = canvas.width = window.innerWidth;
  let height = canvas.height = window.innerHeight;

  window.addEventListener('resize', ()=>{
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
  });

  const cx = width/2;
  const cy = height/2;

  const rand = Math.random;
  const mobile = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase());
  const traceCount = mobile?20:50;

  // ---- TRÁI TIM LỚN ----
  // TẠO TRÁI TIM
  function heartPos(t){
    const x = Math.pow(Math.sin(t),3);
    const y = -(15 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
    return [x,y];
  }
  // PHÓNG TO / THU NHỎ
  function scaleTranslate(pos,sx,sy,dx,dy){
    return [dx + pos[0]*sx, dy + pos[1]*sy];
  }
// ĐIỂM GỐC CỦA TIM
  const pointsOrigin=[];
  const dr = mobile?0.3:0.1;   //TỐI ƯU MOBILE/PC
  for(let i=0;i<Math.PI*2;i+=dr) pointsOrigin.push(scaleTranslate(heartPos(i),210,13,0,0)); //PULSE() TẠO TIM ĐẬP
  for(let i=0;i<Math.PI*2;i+=dr) pointsOrigin.push(scaleTranslate(heartPos(i),150,9,0,0));
  for(let i=0;i<Math.PI*2;i+=dr) pointsOrigin.push(scaleTranslate(heartPos(i),90,5,0,0));
  const heartPointsCount = pointsOrigin.length;

  const targetPoints=[];
  function pulse(kx,ky){
    for(let i=0;i<pointsOrigin.length;i++){
      targetPoints[i]=[];
      targetPoints[i][0] = kx*pointsOrigin[i][0]+cx;   //CX,CY ĐẶT TIM VÀO TRUNG TÂM
      targetPoints[i][1] = ky*pointsOrigin[i][1]+cy;
    }
  }

  // ---- HẠT TRÁI TIM LỚN ----
  const particles=[];
  for(let i=0;i<heartPointsCount;i++){
    let x = rand()*width;
    let y = rand()*height;
    let p = {
      x: x, y: y,
      vx:0, vy:0,
      speed: rand()+5,
      q: Math.floor(rand()*heartPointsCount),
      D: 2*(i%2)-1,
      force: 0.2*rand()+0.7,
      f: `hsla(${30+rand()*30},100%,50%,0.6)`, // đỏ nhạt
      trace: []
    };
    for(let k=0;k<traceCount;k++) p.trace[k]={x:x,y:y};
    particles.push(p);
  }

  const config={traceK:0.4,timeDelta:0.01};
  let time=0;

  // ---- HALO VÒNG XOAY ----
  const haloRadius = 250;
  const haloParticles = 120;
  function drawHalo(){
    for(let i=0;i<haloParticles;i++){
      const angle = (i/haloParticles)*Math.PI*6 + time*2;
      const x = cx + Math.cos(angle)*haloRadius;
      const y = cy + Math.sin(angle)*haloRadius + 20; // vòng dưới trái tim
      const alpha = 0.3 + 0.7*rand(); // nhấp nháy
      ctx.fillStyle = `rgba(255, 142, 30, 0.82),${alpha})`;
      ctx.fillRect(x,y,3,3);
    }
  }

  // ---- HẠT LỬA BAY LÊN TỪ HALO ----
 const flameParticles = [];
const NUM_FLAMES = 200;

for(let i=0; i<NUM_FLAMES; i++){
  const angle = rand()*Math.PI*2; // vị trí ngẫu nhiên trên vòng
  const radius = haloRadius;       // bán kính vòng halo
  const x = cx + Math.cos(angle)*radius; // tọa độ x trên vòng
  const y = cy + Math.sin(angle)*radius + 60; // tọa độ y trên vòng (+60 để vòng dưới trái tim)

  flameParticles.push({
    angle: angle,     // giữ góc để xoay/di chuyển nếu muốn
    radius: radius,
    x: x, 
    y: y,
    vy: 0.5 + rand()*1.5, // tốc độ bay lên
    size: 2 + rand()*2,   // kích thước hạt
    hue: 20 + rand()*30,  // màu cam đỏ
    alpha: 0.5 + rand()*0.5 // độ mờ
  });
}

  function drawFlames(){
    for(let p of flameParticles){
      // Tọa độ ban đầu trên vòng halo
      if(p.y<=0){
        p.x = cx + Math.cos(p.angle)*p.radius;
        p.y = cy + Math.sin(p.angle)*p.radius + 60;
        p.alpha = 0.5+rand()*0.5;
      }
      p.y -= p.vy; // bay lên
      p.alpha -= 0.005; // mờ dần
      if(p.alpha<=0) p.y = -1; // reset
      ctx.fillStyle = `hsla(${p.hue},100%,50%,${p.alpha})`;
      ctx.fillRect(p.x,p.y,p.size,p.size);
    }
  }

  // ---- ANIMATION LOOP ----
  function loop(){
    const n = -Math.cos(time);
    pulse((1+n)*0.5,(1+n)*0.5);
    time += ((Math.sin(time)<0)?9:(n>0.8)?0.2:1)*config.timeDelta;

    // nền mờ để tạo glow
    ctx.fillStyle="rgba(0,0,0,0.1)";
    ctx.fillRect(0,0,width,height);

    drawHalo();
    drawFlames();

    // Vẽ hạt trái tim
    for(let i=0;i<particles.length;i++){
      const u = particles[i];
      const q = targetPoints[u.q];
      let dx = u.trace[0].x - q[0];
      let dy = u.trace[0].y - q[1];
      let length = Math.sqrt(dx*dx+dy*dy)+0.01;

      if(length<10){
        if(rand()>0.95) u.q = Math.floor(rand()*heartPointsCount);
        else{
          if(rand()>0.99) u.D*=-1;
          u.q += u.D;
          u.q = (u.q+heartPointsCount)%heartPointsCount;
        }
      }

      u.vx += -dx/length*u.speed;
      u.vy += -dy/length*u.speed;
      u.trace[0].x += u.vx;
      u.trace[0].y += u.vy;
      u.vx *= u.force;
      u.vy *= u.force;

      for(let k=0;k<u.trace.length-1;k++){
        const T = u.trace[k];
        const N = u.trace[k+1];
        N.x -= config.traceK*(N.x-T.x);
        N.y -= config.traceK*(N.y-T.y);
      }

      ctx.fillStyle = u.f;
      for(let k=0;k<u.trace.length;k++){
        ctx.fillRect(u.trace[k].x,u.trace[k].y,2,2);
      }
    }

    requestAnimationFrame(loop);
  }

  loop();
})();
</script>
</body>
</html>
